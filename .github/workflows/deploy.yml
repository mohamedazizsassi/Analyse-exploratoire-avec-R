name: Deploy Quarto Website

on:
  push:
    branches: [main]

permissions:
  pages: write
  id-token: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Setup Quarto
        uses: quarto-dev/quarto-actions/setup@v2

      - name: Render website
        run: |
          # Rendre le site
          quarto render
          
          # VÃ©rifier ce qui a Ã©tÃ© gÃ©nÃ©rÃ©
          echo "ðŸ“ Contenu du dossier docs/:"
          ls -la docs/
          
          # Renommer index.qmd.html en index.html si nÃ©cessaire
          if [ -f "docs/index.qmd.html" ] && [ ! -f "docs/index.html" ]; then
            mv docs/index.qmd.html docs/index.html
            echo "âœ… RenommÃ© index.qmd.html -> index.html"
          fi
          
          # CrÃ©er index.html s'il n'existe pas
          if [ ! -f "docs/index.html" ]; then
            echo '<!DOCTYPE html>
            <html>
            <head>
              <title>Data Analysis Lab</title>
              <meta http-equiv="refresh" content="0; url=./qmd/01-pivot-tables-with-libreoffice.html">
            </head>
            <body>
              <p>Redirecting to lab exercises... <a href="./qmd/01-pivot-tables-with-libreoffice.html">Click here if not redirected</a></p>
            </body>
            </html>' > docs/index.html
            echo "âœ… index.html crÃ©Ã© avec redirection"
          fi
          
          # Fichier obligatoire pour GitHub Pages
          touch docs/.nojekyll
          
          # VÃ©rification finale
          echo "âœ… Fichiers dans docs/:"
          find docs -name "*.html" | head -10

      - name: Upload to GitHub Pages
        uses: actions/upload-pages-artifact@v3
        with:
          path: docs/

      - name: Deploy
        uses: actions/deploy-pages@v3